# Linux磁盘及文件系统管理
- I/O: Disks(持久存储数据), Ehtercard
- 接口类型：
    - 并口：同一线缆可以接多块设备；
        - IDE(ata)：两个，主，从，IDE(ata)
        - SCSI：Ultrascsi320, 320MB/S, UltraSCSI640, 640MB/S
            宽带：16-1个设备
            窄带：8-1个设备
    - 串口：同一线缆只可以接一个设备；
        - SATA：串口，6gbps
        - SAS：串口，6gbps
        - USB：串口，480MB/s

- iops：io per second

- 硬盘：
    - 机械硬盘：
        - track：磁道
        - sector：扇区，512bytes
        - cylinder：柱面（分区划分基于柱面）
        - 平均寻道时间。5400rpm, 7200rpm, 10000rpm, 15000rpm
    - 固态硬盘

- 设备类型：
    - block，块设备，存取单位是块，如硬盘
    - char，字符设备，存取单位是字符，如键盘

- 设备文件FHS：/dev，关联设到设备的驱动程序；设备访问的入口
    - 设备号：
        - 主设备号：表示设备类型，即所需要的驱动程序
        - 次设备号：表示同意类型下的不同设备，特定设备的访问入口
    - mknod：make block or character special files
        - `mknod [OPTION]... NAME TYPE [MAJOR MINOR]`
            - -m, --mode=MODE：创建后的设备文件权限
        - 分区：/dev/sda[1-9]，centos6和7，硬盘文件表示为/dev/sd[a-z]#
        - 设备文件名：ICANN
            - 硬盘：
                - IDE：/dev/hd[ab]，可以接两个
                - SCSI, SATA, USB, SAS：/dev/sd[a-z]
        - 设备的引用：设备文件名、卷标、UUID

- 磁盘分区：MBR(Master Boot Record)，GPT
    - MBR：0磁道0扇区，512字节：分为三个部分
        - 前446Byte：存储boot loader，引导加载器
        - 64Byte：存储分区表，每16字节，标识一个分区，最多4个分区；
            - 若4个主分区，不够用，可以划分出一个逻辑分区，将逻辑分区再进行划分
        - 2Byte：MBR区域的有效性标识；`55AA`为有效，
        - 主分区只能是1-4，逻辑分区为5+
    - GPT：

- fdisk：manipulate disk partition table
    - fdisk -l [-u] [device...]：查看分区
    - fdisk device：管理分区，提供了一个交互式接口，有多种子命令来管理分区，其所有操作均在内存中完成，没有同步到磁盘，直到w命令保存到磁盘上
    - 常用命令：
        - n：创建新分区
        - d：删除已有分区
        - t：修改分区类型
        - l：查看所有已经ID
        - w：保存并退出
        - q：不保存并退出
        - m：查看帮助信息
        - p：显示现有分区信息
    - 注意：在已经分区并且已经挂载其中某个分区的磁盘设备上创建的新分区，内核可能在创建完成后无法直接识别，在`/proc/partitions`中查看
        - 让内核强制重读磁盘分区表
            - centos 5：partprobe [device]
            - centos 6, 7：`partx -a [device]`或者`kpartx -af [device]`
    - 分区创建工具：parted，sfdisk

- 创建文件系统
    - 格式化：
        - 低级格式化：区分之前进行，划分磁道
        - 高级格式化：分区之后进行，创建文件系统
    - 元数据区、数据区：
        - 元数据区：
            - 文件元数据（inode，index node）：大小，权限，属主属组、时间戳，数据块指针
        - 连接文件：存储数据指针的空间当中存储的是真是文件的访问路径，没有占用的数据空间
        - 设备文件：存储数据指针的空间当中存储的是设备号，没有占用的数据空间
    - bitmap index：位图索引，记录磁盘块是否空闲等信息

- VFS：virtual file system
    - Linux文件系统：ext2（无日志）, ext3, ext4, xfs, reiserfs, btrfs
    - 光盘：iso 9660
    - 网络文件系统：nfs，cifs
    - 集群文件系统：gfs2，ocfs2
    - windows文件系统：vfat，ntfs
    - 伪文件系统：proc，sysfs，tmpfs，hugepagefs
    - unix文件系统：UFS，FFS，JFS
    - 交换分区文件熊：swap

- 文件系统的管理工具：
    - 创建文件系统的工具：mkfs：mkfs.ext2, ...
    - 检测及修复文件系统的工具：fsck：fsck.ext2, ...
    - 查看其属性的工具：dumpe2fs, tune2fs
    - 调整文件系统特性：tune2fs

- journal：

- 链接文件
    - 硬链接：指向同一个inode的多个文件路径
        - 特性：
            1. 目录不支持链接；
            2. 硬链接不能跨文件系统；
            3. 创建硬链接会增加inode引用次数
            4. 文件大小和原文件相同
        - 创建：`ln SOURCE LINK_FILE`
    - 软链接：符号链接，指向一个文件路径的另外一个文件路径
        - 特性：
            1. 符号链接与文件是两人各自独立的文件，各有自己的inode。对原文件创建符号链接不会增加引用计数；
            2. 支持对目录创建符号链接，可以跨文件系统；
            3. 删除符号链接文件不影响原文件；但删除原文件，符号指定的路径即不存在，此时会变成无效链接
            4. 文件大小是指定的文件的路径字符串字节数
        - 创建：`ln -s SRC LINK_FILE`
    - -v，--verbose：

- https://www.jianshu.com/p/bf939474d69b
- 内核级文件系统的组成部分：文件系统驱动：由内核提供；文件系统管理工具：由用户空间的应用程序提供
- ext系列文件系统的创建工具：mkfs.ext2, mkfs.ext3, mkfs.ext4
    - mke2fs：
        - mke2fs [OP] device
            - -t {ext2 | ext3 | ext4}：指定文件系统类型：mkfs.ext4 = mkfs -t ext4 = mke2fs -t ext4
            - -b {1024 | 2048 | 4096}：指定块大小
            - -L new-volume-label：打标
            - -j：创建有日志功能的文件系统ext3：              
            - -i #：每多少字节创建一个inode
            - -N #：指定inode数
            - -O ：指定区特性：`mke2fs -j = mke2fs -t ext3 = mkfs -t ext3 = mkfs.ext3 = mke2fs -O has_journal`
            - -m：指定预留空间占整个分区空间的百分比，默认为5%
- blkid：查看指定块设备的属性信息：`blkid [-L label | -U uuid] DEVIC`
- e2label：卷标的查看与设定：`e2label device [LABEL]`
- tune2fs：查看或修改ext系列文件系统的某些属性
- dumpe2fs
- 文件系统检测

